<div class="fixed inset-0 z-[60] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-fadeIn">

  <div class="w-full max-w-2xl bg-[var(--color-card-bg)] border border-[var(--color-border)] rounded-2xl shadow-2xl flex flex-col overflow-hidden h-[85vh] md:h-auto md:max-h-[90vh]">

    <div class="p-5 border-b border-[var(--color-border)] bg-[var(--color-card-bg-light)] flex justify-between items-center shrink-0">
      <div class="flex items-center gap-3">

        <div>
          <h2 class="text-lg font-bold text-white leading-tight">Nueva Ubicación</h2>
          <p class="text-xs text-[var(--color-text-muted)]">Marca tu posición en el mapa</p>
        </div>
      </div>

      <button (click)="cancel()" class="w-8 h-8 rounded-full hover:bg-white/10 flex items-center justify-center text-[var(--color-text-muted)] transition-colors">
        ✕
      </button>
    </div>

    <div class="p-5 overflow-y-auto custom-scrollbar flex flex-col gap-5 bg-[var(--color-card-bg)]">

      <div class="flex flex-col gap-2">
        <label class="text-sm font-semibold text-[var(--color-text-light)] ml-1">Nombre de la ubicación <span class="text-red-400">*</span></label>
        <input
          type="text"
          [(ngModel)]="label"
          placeholder="Ej: Casa, Oficina, Gimnasio..."
          class="w-full px-4 py-3 rounded-xl bg-[var(--color-background)] border border-[var(--color-border)] text-white placeholder-gray-600 focus:border-[var(--color-primary)] focus:ring-1 focus:ring-[var(--color-primary)] focus:outline-none transition-all"
        >
      </div>

      <div class="flex flex-col gap-2 flex-1 min-h-[350px]">
        <label class="text-sm font-semibold text-[var(--color-text-light)] ml-1">Selecciona en el mapa <span class="text-red-400">*</span></label>

        <div class="rounded-xl overflow-hidden border border-[var(--color-border)] shadow-inner h-full">
           <app-map-location-picker
              height="100%"
              [initialZoom]="15"
              (locationSelected)="onLocationSelected($event)">
           </app-map-location-picker>
        </div>
      </div>

    </div>

    <div class="p-5 border-t border-[var(--color-border)] bg-[var(--color-card-bg-light)] flex justify-end gap-3 shrink-0">
      <button
        (click)="cancel()"
        class="px-6 py-2.5 rounded-xl font-medium text-[var(--color-text-muted)] hover:text-white hover:bg-white/5 border border-transparent hover:border-[var(--color-border)] transition-all">
        Cancelar
      </button>

      <button
        (click)="saveLocation()"
        [disabled]="isSaving || !selectedCoords || !label"
        class="px-6 py-2.5 rounded-xl font-bold bg-[var(--color-primary)] text-white hover:brightness-110 disabled:opacity-50 disabled:grayscale disabled:cursor-not-allowed flex items-center gap-2 shadow-lg shadow-orange-500/20 transition-all active:scale-95">

        <span *ngIf="isSaving" class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></span>

        <span>{{ isSaving ? 'Guardando...' : 'Guardar Ubicación' }}</span>
      </button>
    </div>

  </div>
</div>
