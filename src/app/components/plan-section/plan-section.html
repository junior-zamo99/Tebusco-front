<section class="relative py-24 bg-slate-950 isolate overflow-hidden">

  <div class="absolute inset-0 pointer-events-none -z-10">
    <div class="absolute inset-0 opacity-[0.03]"
         style="background-image: linear-gradient(#fff 1px, transparent 1px), linear-gradient(90deg, #fff 1px, transparent 1px); background-size: 40px 40px;">
    </div>
    <div class="absolute top-0 right-0 -translate-y-1/2 translate-x-1/3 w-96 h-96 bg-primary/20 rounded-full blur-[120px]"></div>
    <div class="absolute bottom-0 left-0 translate-y-1/3 -translate-x-1/3 w-96 h-96 bg-blue-600/10 rounded-full blur-[120px]"></div>
  </div>

  <div class="max-w-7xl mx-auto px-6 lg:px-8 relative z-10">

    <div class="text-center max-w-2xl mx-auto mb-16">
      <span class="text-primary font-bold tracking-widest text-xs uppercase mb-3 block">Precios Flexibles</span>
      <h2 class="text-4xl md:text-5xl font-black text-white mb-6 tracking-tight">
        Planes diseñados para <br />
        <span class="text-transparent bg-clip-text bg-gradient-to-r from-primary to-orange-400">Tu Crecimiento</span>
      </h2>
      <p class="text-slate-400 text-lg">
        Elige la herramienta adecuada para potenciar tu perfil profesional. Sin contratos forzosos, cancela cuando quieras.
      </p>

      <div class="mt-10 inline-flex bg-slate-900/80 backdrop-blur-md p-1.5 rounded-full border border-white/10 shadow-2xl relative" *ngIf="availableIntervals.length > 0">
        <button *ngFor="let interval of availableIntervals"
                (click)="selectInterval(interval)"
                class="relative px-6 py-2.5 rounded-full text-sm font-bold transition-all duration-300 z-10"
                [ngClass]="selectedInterval === interval ? 'text-slate-950' : 'text-slate-400 hover:text-white'">

          {{ intervalLabels[interval] }}

          <div *ngIf="selectedInterval === interval"
               class="absolute inset-0 bg-primary rounded-full -z-10 shadow-[0_0_20px_rgba(250,204,21,0.4)] animate-fade-in">
          </div>
        </button>
      </div>
    </div>

    <div *ngIf="isLoading" class="flex flex-col justify-center items-center py-20 space-y-4">
      <div class="animate-spin rounded-full h-12 w-12 border-4 border-slate-800 border-t-primary"></div>
      <p class="text-slate-500 text-sm animate-pulse">Cargando mejores ofertas...</p>
    </div>

    <div *ngIf="errorMessage" class="text-center max-w-md mx-auto py-10 px-6 bg-red-500/10 rounded-2xl border border-red-500/20">
      <p class="text-red-400 font-medium">{{ errorMessage }}</p>
    </div>

    <div *ngIf="!isLoading && plans.length > 0"
         class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 lg:gap-6 items-start">

      <div *ngFor="let plan of plans"
           class="group relative flex flex-col h-full rounded-[2rem] transition-all duration-500"
           [ngClass]="isRecommended(plan)
             ? 'bg-slate-900/80 border-2 border-primary shadow-[0_0_40px_rgba(250,204,21,0.15)] scale-105 z-10'
             : 'bg-slate-900/40 border border-white/5 hover:border-white/10 hover:bg-slate-900/60'">

        <div *ngIf="isRecommended(plan)"
             class="absolute -top-4 left-1/2 -translate-x-1/2 bg-gradient-to-r from-primary to-orange-500 text-slate-950 text-xs font-black uppercase tracking-wider px-4 py-1.5 rounded-full shadow-lg">
          Más Popular
        </div>

        <div class="p-8 flex flex-col h-full">

          <div class="mb-6">
            <h3 class="text-xl font-bold text-white mb-2 group-hover:text-primary transition-colors">{{ plan.name }}</h3>
            <p class="text-sm text-slate-400 leading-relaxed min-h-[40px]">
              {{ plan.description }}
            </p>
          </div>

          <div class="mb-8 p-5 bg-slate-950/50 rounded-2xl border border-white/5" *ngIf="getIntervalForPlan(plan) as interval">
            <div class="flex items-baseline justify-center gap-1">
              <span class="text-4xl font-black text-white tracking-tight">
                {{ interval.pricePerPeriod }}
              </span>
              <span class="text-lg font-bold text-primary">
                {{ interval.currency }}
              </span>
            </div>
            <div class="text-center text-xs font-medium text-slate-500 mt-1 uppercase tracking-wide">
              {{ intervalLabels[selectedInterval] }}
            </div>

            <div *ngIf="calculateSavings(plan, interval) as savings"
                 class="mt-3 text-center">
              <span class="inline-block bg-green-500/10 text-green-400 text-[10px] font-bold px-2 py-0.5 rounded border border-green-500/20">
                 AHORRAS {{ savings.percentage }}%
              </span>
            </div>
          </div>

          <div class="w-full h-px bg-gradient-to-r from-transparent via-white/10 to-transparent mb-8"></div>

          <div class="flex-1 space-y-4 mb-8" *ngIf="getIntervalForPlan(plan) as interval">
            <ng-container *ngIf="interval.features.length > 0">
              <div *ngFor="let feature of interval.features" class="flex items-start gap-3">

                <div class="flex-shrink-0 w-5 h-5 rounded-full bg-primary/10 flex items-center justify-center mt-0.5">
                  <svg class="w-3 h-3 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                  </svg>
                </div>

                <div class="flex-1 text-sm text-slate-300 flex items-center flex-wrap gap-1.5">
                  <span class="font-medium">
                    <span *ngIf="feature.limitValue && !feature.isUnlimited" class="text-white font-bold">
                      {{ feature.limitValue }}
                    </span>
                    <span *ngIf="feature.isUnlimited" class="text-white font-bold">∞</span>
                    {{ feature.featureName }}
                  </span>

                  <div class="group/tooltip relative flex items-center ml-1">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         class="w-4 h-4 text-slate-600 hover:text-primary cursor-help transition-colors duration-200"
                         fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>

                    <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-3 bg-slate-800 border border-slate-600 text-white text-xs rounded-xl shadow-xl opacity-0 invisible group-hover/tooltip:opacity-100 group-hover/tooltip:visible transition-all duration-200 z-50 text-center pointer-events-none transform translate-y-2 group-hover/tooltip:translate-y-0">
                      {{ feature.description }}
                      <div class="absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-slate-800 border-b border-r border-slate-600 rotate-45"></div>
                    </div>
                  </div>

                </div>
              </div>
            </ng-container>

            <div *ngIf="interval.features.length === 0" class="text-center py-6">
              <p class="text-slate-600 text-xs italic">Incluye funciones esenciales</p>
            </div>
          </div>

          <a [routerLink]="['/register']"
             class="w-full py-4 rounded-xl font-bold text-sm tracking-wide transition-all duration-300 text-center block relative overflow-hidden group/btn"
             [ngClass]="isRecommended(plan)
               ? 'bg-primary text-slate-950 shadow-lg shadow-primary/25 hover:shadow-primary/40 hover:-translate-y-1'
               : 'bg-white/5 text-white border border-white/10 hover:bg-white/10 hover:border-white/20'">

            <span class="relative z-10">Elegir {{ plan.name }}</span>

            <div *ngIf="isRecommended(plan)" class="absolute inset-0 bg-white/20 translate-y-full group-hover/btn:translate-y-0 transition-transform duration-300"></div>
          </a>

          <div *ngIf="!getIntervalForPlan(plan)" class="absolute inset-0 bg-slate-950/80 backdrop-blur-[2px] rounded-[2rem] flex flex-col items-center justify-center z-20 text-center p-6 border border-white/5">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-slate-600 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
            </svg>
            <span class="text-slate-400 font-medium text-sm">
              No disponible en<br>plan {{ intervalLabels[selectedInterval] | lowercase }}
            </span>
          </div>

        </div>
      </div>

    </div>
  </div>
</section>
